<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.5.57">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Snowmelt and Streamflow: The Role of Snow Water Equivalent in Shaping Discharge Patterns in the Cache la Poudre River</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      /* CSS for citations */
      div.csl-bib-body { }
      div.csl-entry {
        clear: both;
        margin-bottom: 0em;
      }
      .hanging-indent div.csl-entry {
        margin-left:2em;
        text-indent:-2em;
      }
      div.csl-left-margin {
        min-width:2em;
        float:left;
      }
      div.csl-right-inline {
        margin-left:2em;
        padding-left:1em;
      }
      div.csl-indent {
        margin-left: 2em;
      }    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>  
      <meta name="citation_title" content="Snowmelt and Streamflow: The Role of Snow Water Equivalent in Shaping Discharge Patterns in the Cache la Poudre River">
<meta name="citation_author" content="Maya McCain">
<meta name="citation_author" content="Emily Mitchell">
<meta name="citation_author" content="Ally Lewis">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=How does snow persistence relate to annual streamflow in mountain watersheds of the western US with wet maritime and dry continental climates?;,citation_author=John C Hammond;,citation_author=Freddy A Saavedra;,citation_author=Stephanie K Kampf;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=4;,citation_volume=54;,citation_journal_title=Water Resources Research;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Importance analysis of local and global climate inputs for basin-scale streamflow prediction;,citation_author=Rajib Maity;,citation_author=SS Kashid;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=11;,citation_volume=47;,citation_journal_title=Water Resources Research;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Investigating the role of snow water equivalent on streamflow predictability during drought;,citation_author=Parthkumar A Modi;,citation_author=Eric E Small;,citation_author=Joseph Kasprzyk;,citation_author=Ben Livneh;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=10;,citation_volume=23;,citation_journal_title=Journal of Hydrometeorology;">
<meta name="citation_reference" content="citation_title=Physically based modeling of many-year dynamics of daily streamflow and snow water equivalent in the lena r. basin;,citation_author=EM Gusev;,citation_author=ON Nasonova;,citation_author=L Ya Dzhogan;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_volume=43;,citation_journal_title=Water Resources;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Geomorphic characteristics influencing post-fire river response in mountain streams.;,citation_abstract=As wildfires increase in frequency and severity, there is a growing interest in understanding river response to the wildfire disturbance cascade. Numerous headwater mountain catchments within the Cache la Poudre (Poudre) River basin in the Colorado Front Range, USA burned severely and extensively during the 2020 Cameron Peak fire. Debris flows and flash floods occurred in many of these catchments triggered by convective storms after the fire. The downstream effects of the floods and sediment varied along a continuum from attenuated and largely contained within the catchment, to releasing substantial volumes of water and sediment to the Poudre River. We conceptualize these catchments as exhibiting decreasing absorbance of post-fire disturbance along the continuum described above based on the geomorphic evidence of relative sediment export. We conceptualize characteristics on different spatial scales as driving or resisting response to disturbance and therefore impacting the absorbing c;,citation_author=Shayla Triantafillou;,citation_author=Ellen Wohl;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://ezproxy2.library.colostate.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&amp;amp;amp;amp;AuthType=cookie,ip,url,cpid&amp;amp;custid=s4640792&amp;amp;db=aph&amp;amp;AN=180492756&amp;amp;site=ehost-live;,citation_issn=0169555X;,citation_volume=466;,citation_journal_title=Geomorphology;">
<meta name="citation_reference" content="citation_title=Snowpacks decrease and streamflows shift across the eastern US as winters warm.;,citation_author=Chanse M. Ford;,citation_author=Anthony D. Kendall;,citation_author=David W. Hyndman;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://ezproxy2.library.colostate.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&amp;amp;amp;amp;AuthType=cookie,ip,url,cpid&amp;amp;custid=s4640792&amp;amp;db=asn&amp;amp;AN=152080320&amp;amp;site=ehost-live;,citation_issn=00489697;,citation_volume=793;,citation_journal_title=Science of the Total Environment;">
<meta name="citation_reference" content="citation_title=Hydrological response of an alpine catchment to rainfall and snowmelt events;,citation_abstract=Summary Alpine catchments are important sources of fresh water but compared to lower altitude catchments our understanding of the hydrological functioning of these catchments during rainfall and snowmelt events is still limited. The objectives of this study were i) to identify the dominant runoff generation mechanisms in the 0.14-km2 Bridge Creek Catchment in the Italian Dolomites during nine rainfall–runoff events and six snowmelt–runoff events in spring, summer and autumn of 2010–2012; and ii) to assess the effect of the selection of the pre-event water sample on the isotope hydrograph separation results. The isotopic composition of the pre-event water was determined by either a stream water sample taken prior to the event or the average of 19 stream water samples taken during baseflow conditions. The hydrograph separation results for the two methods were very similar for the rainfall events but differed for the snowmelt events. Average event water contributions ranged between 4;,citation_author=D. Penna;,citation_author=H. J. Meerveld;,citation_author=G. Zuecco;,citation_author=G. Dalla Fontana;,citation_author=M. Borga;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S0022169416301457;,citation_doi=https://doi.org/10.1016/j.jhydrol.2016.03.040;,citation_issn=0022-1694;,citation_volume=537;,citation_journal_title=Journal of Hydrology;">
<meta name="citation_reference" content="citation_title=The value of accurate high-resolution and spatially continuous snow information to streamflow forecasts.;,citation_abstract=Previous studies have shown limited success in improving streamflow forecasting for snow-dominated watersheds using physically based models, primarily due to the lack of reliable snow water equivalent (SWE) information. Here we use a hindcasting approach to evaluate the potential benefit that a high-resolution, spatiotemporally continuous, and accurate SWE reanalysis product would have on the seasonal streamflow forecast in the snow-dominated Sierra Nevada mountains of California if such an SWE product were available in real time. We tested the efficacy of a physically based ensemble streamflow prediction (ESP) framework when initialized with the reanalysis SWE. We reinitialized the SWE over the Sierra Nevada at the time when the Sierra Nevada had domain-wide annual maximum SWE for each year in 1985–2015, and on 1 February of the driest years within the same period. The early season forecasts on 1 February provide valuable lead time for mitigating the impact of drought. In both experi;,citation_author=Dongyue Li;,citation_author=Dennis P. Lettenmaier;,citation_author=Steven A. Margulis;,citation_author=Konstantinos Andreadis;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://ezproxy2.library.colostate.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&amp;amp;amp;amp;AuthType=cookie,ip,url,cpid&amp;amp;custid=s4640792&amp;amp;db=asn&amp;amp;AN=136116302&amp;amp;site=ehost-live;,citation_issue=4;,citation_issn=1525755X;,citation_volume=20;,citation_journal_title=Journal of Hydrometeorology;">
<meta name="citation_reference" content="citation_title=USGS 06752000 CACHE LA POUDRE RIV AT MO OF CN, NR FT COLLINS, CO;,citation_author=U.S. Geological Survey;,citation_publisher=https://waterdata.usgs.gov/co/nwis/inventory/?site_no=06752000;">
<meta name="citation_reference" content="citation_title=SNOTEL site: 551 (Berthoud Summit);,citation_author=U.S. Department of Agriculture, Natural Resources Conservation Service;,citation_publisher=https://wcc.sc.egov.usda.gov/nwcc/site?sitenum=551;">
</head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a href="./index.qmd" class="btn btn-primary quarto-download-embed" download="index.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Snowmelt and Streamflow: The Role of Snow Water Equivalent in Shaping Discharge Patterns in the Cache la Poudre River</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Maya McCain </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Colorado State University
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Emily Mitchell </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Colorado State University
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Ally Lewis </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Colorado State University
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Water is an integral part of ecosystems and human-related necessities. Understanding the relationship between snow water equivalent (SWE) and streamflow can highlight important indicators for water management, drought, flood risk, and ecosystem health, especially in regions where snowmelt is a large factor in the annual hydrological cycle. By investigating this relationship, researchers can begin to further understand indicators for water management, predicting drought, flood mitigation, and sustainability in areas where snow is one of the largest contributors to the water cycle.</p>
<p>SWE, or snow water equivalent, refers to the amount of water that is stored in the snowpack each season. The runoff from local snowpack every spring is a significant source of water that replenishes nearby streams and aquifers <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi, Small, Kasprzyk, &amp; Livneh, 2022</a>)</span>. This water cycle can be affected by a number of environmental factors, such as solar radiation, temperature, and anthropogenic sources. The effects from these factors can range from changes in streamflow patterns to changes in local ecological health and water availability.</p>
<p>One of the primary metrics for monitoring and interpreting streamflow is discharge data, which quantifies the volume of water moving through a river channel over time. This data can be utilized to make decisions about water use for agriculture, industry, hydroelectric power, and domestic use <span class="citation" data-cites="maity2011">(<a href="#ref-maity2011" role="doc-biblioref">Maity &amp; Kashid, 2011</a>)</span>. Increasing pressures on freshwater resources mean that water must be treated as an invaluable resource that requires careful management in order to prevent overconsumption, depletion, and ecological damage.</p>
<p>Climate change is undoubtedly one of the most pressing challenges humans face, as well as one that is tied to the relationship between snowpack and streamflow. Changing global temperatures significantly impacting the hydrologic cycle is a growing concern that is highly linked to water resource use <span class="citation" data-cites="hammond2018">(<a href="#ref-hammond2018" role="doc-biblioref">Hammond, Saavedra, &amp; Kampf, 2018</a>)</span>. Rising temperatures and shifting precipitation patterns also influence snow accumulation and subsequently snowmelt and streamflow <span class="citation" data-cites="hammond2018">(<a href="#ref-hammond2018" role="doc-biblioref">Hammond et al., 2018</a>)</span>. Understanding these interconnected processes is essential for ensuring sustainable water resource management as humans continue to adapt to a changing world.</p>
<p>Drought, an increasingly frequent occurrence due to climate change, has a particularly negative impact on water supply and discharge. This is important to take into consideration when predicting streamflow, especially where water availability is heavily reliant on snowmelt <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. As drought conditions become more problematic and streamflow becomes harder to predict, the impact to water users and ecological stability grows too. However, the relationship between snow water equivalent and discharge may be used to create models for streamflow predictability <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. An important factor to consider when building these models and diving into streamflow predictability is the influence on time lag between precipitation and discharge changes <span class="citation" data-cites="maity2011">(<a href="#ref-maity2011" role="doc-biblioref">Maity &amp; Kashid, 2011</a>)</span>. This lag can also be influenced by basin topography and environmental factors that should be taken into account.</p>
<p>In the western United States, many watersheds are snow-dominated, meaning that snowpack serve as a primary source of water for rivers, streams, and aquifers during warmer months. Snow-dominated basins, including those in the Rocky Mountains of Colorado, have a predictive relationship between snow water equivalent (SWE) and water supply and availability <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. This relationship between snowpack and discharge is especially relevant in the Cache la Poudre River because streamflow is influenced by the timing and quantity of snowmelt. Studying this relationship will allow for better understanding of the drivers of discharge rates and variability and help develop more accurate tools for predicting water availability. It is important to be prepared for variable water levels that may have implications on the environment and anthropogenic uses.</p>
<p>In order to explore the relationship between snow water equivalent and discharge, we will utilize hydrological data from two sources. The SWE data will be from the Joe Wright SNOTEL Station (Station 551) and the corresponding discharge data will be from a gauge sight near the mouth of the Cache La Poudre River Canyon. The snow water equivalent data is available from the Natural Resources Conservation Service while the discharge data for the Cache la Poudre River is from the Colorado Division of Water Resources. By synthesizing and analyzing these datasets, we aim to investigate how changes in snowpack levels impact river discharge.</p>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<p>The datasets we are looking at are daily average Snow Water Equivalent (SWE) data and daily average discharge data recorded in the Cache la Poudre River. The SWE data, obtained from the Natural Resources Conservation Service, consists of observations from the Joe Wright SNOTEL Station (Station 551). The dates of collection that we will be looking at span from the year 2000 to 2024. The discharge data was obtained from the Colorado Division of Water Resources website from a DWR/USGS gauge site titled “Cache La Poudre at Canyon Mouth Near Fort Collins” located on the left bank of the river approximately 9 miles northwest of Fort Collins. The dates of collection that we will be looking at align with the SWE data (2000 - 2024).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataRetrieval)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.3.0 ──
✔ broom        1.0.8     ✔ rsample      1.3.0
✔ dials        1.4.0     ✔ tune         1.3.0
✔ infer        1.0.8     ✔ workflows    1.2.0
✔ modeldata    1.4.0     ✔ workflowsets 1.1.0
✔ parsnip      1.3.1     ✔ yardstick    1.3.2
✔ recipes      1.3.0     
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'tsibble':
  method               from 
  as_tibble.grouped_df dplyr

Attaching package: 'tsibble'

The following object is masked from 'package:zoo':

    index

The following object is masked from 'package:lubridate':

    interval

The following objects are masked from 'package:base':

    intersect, setdiff, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feasts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: fabletools

Attaching package: 'fabletools'

The following object is masked from 'package:yardstick':

    accuracy

The following object is masked from 'package:parsnip':

    null_model

The following objects are masked from 'package:infer':

    generate, hypothesize</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'

The following object is masked from 'package:ggplot2':

    last_plot

The following object is masked from 'package:stats':

    filter

The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>swe_disch <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/github/ess-330-lab-07/data/realfinal.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3911 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): Q, swe
date (1): date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>monthlyfinal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/github/ess-330-lab-07/data/monthlyfinal.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 130 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (4): year, month, mean_streamflow, mean_swe

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div></div>
<p><strong>Figure 1. SWE and Discharge Data Visualization</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>visdat<span class="sc">::</span><span class="fu">vis_dat</span>(swe_disch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p><strong>Figure 2. Discharge Visualization for Linear Regression Assumptions</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swe_disch, <span class="fu">aes</span>(<span class="at">x =</span> Q)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p>To clean our data, we dropped all of the NA values. To merge the datasets and continue with our methods, we adjusted the format and groupings of the dates and further explored the distribution of the variables. We had difficulty with aligning the dates properly, but were able to organize them effectively through the use of the package Tidyr in Rstudio. We then log transformed our variables to ensure the assumptions of our statistical tests were met.</p>
<p>We decided to focus our project on a local scope. The Cache la Poudre River runs through Fort Collins and is an important drinking water source. We have narrowed down our analysis from a 24 year period to a 10 year period, ranging from 2013 to 2023. To analyze our data, we completed a number of statistical and visual analyses of our two hydrologic datasets, one for snow water equivalent taken from the Joe Wright SNOTEL station, and another for discharge data from the Canyon Mouth gauge near Fort Collins. These datasets included daily collections for easy alignment and analysis, and spanned over a 24-year period that allow us to examine long-term trends that might appear. This included creating both scatter plots and time series visualizations. A paired t-test was completed to identify the strength of the relationship between snow water equivalent and stream discharge. Additionally, a cross-correlation analysis was made to try and visualize this relationship between our variables, and whether or not there are noticeable seasonal lags from the time of snow water equivalent collection and stream discharge. This was done by comparing each variable under different time shifts, and determining which time shift created the highest level of correlation. This determines the lag period between the two values.</p>
<p>We currently have our core datasets and do not see additional data being needed unless we run into complications with our current data, or decide to do additional comparisons with variables such as temperature or precipitation. Possible data complications would include missing variables within either set of data as well as possible extreme outlier variables from severe drought or flood years, which would require additional data cleaning and possibly force us to narrow down our window of time. Possible method complications include date mismatches between each set which would cause issues when merging them for analysis. Our methods of analysis will directly aid in our ability to recognize a relationship between snow water equivalent and stream discharge data.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>We visualized streamflow of the Cache la Poudre River and snow water equivalent from the Joe Wright SNOTEL Station using time series analysis. Seasonal changes explain yearly peaks and declines in both discharge and snow water equivalent (Figure 1). In 2011, there was an abnormal peak in snow water equivalent, which correlates with the peak streamflow in 2011 in the Poudre River. The mid-2010s show high peaks in streamflow. In 2012, there was an unusual drop in both snow water equivalent and streamflow (Figure 1).</p>
<p>Late Spring and early Summer months depicted higher discharge patterns at the mouth of the Cache la Poudre River (Figure 2). May through July depict higher discharge levels as opposed to the later Summer, Fall, and early Spring months. There was a noticeable lag between each variable, with an increase in stream discharge being noted prior to an increase in snow water equivalent. This shows a distinct causational relationship between snow water equivalent and stream discharge, where snow melt increases streamflow after temperatures increase and the melted snowpack reaches the river.</p>
<p>We also conducted a simple linear regression analysis to determine the relationship between SWE and the logarithm of discharge (Q_log) within our dataset (Figure 3). The model revealed a statistically significant positive relationship between SWE and Q_log ((β = 0.149, SE = 0.002, t = 71.95, p &lt; 2 × 10-16). This indicates that increases in SWE are associated with increases in streamflow. When SWE is zero, the expected discharge value is 3.02. The residual standard error was 1.67, based on 7,798 degrees of freedom. Furthermore, the model accounted for approximately 40% of the variance in Q_log, suggesting a moderate fit (R² = 0.399, adjusted R² = 0.399). Although an R-squared value of 0.399 indicates that a substantial portion of the variance in streamflow remains unexplained, we consider it to be satisfactory in this context. Streamflow is influenced by a wide range of environmental factors not included in this analysis, so having a single predictor (SWE) explain nearly 40% of the variance is meaningful in a variety of ways. While including additional predictor variables such as precipitation, soil type, slope, and land cover may improve overall model performance, this result highlights the role SWE plays in driving discharge variability. It also serves as a solid foundation for future research that incorporates additional dynamics or model structures.</p>
<p><strong>Figure 3. Streamflow in the Cache la Poudre River and Joe Wright SNOTEL Station SWE over a 20 year period.</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>disch_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(swe_disch, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> Q)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cache la Poudre River Streamflow"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Discharge (cfs)"</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>swe_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(swe_disch, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> swe)) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Joe Wright SNOTEL Station SWE"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Snow Water Equivalent"</span>) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>disch_plot <span class="sc">+</span> swe_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p><strong>Figure 4. Average Monthly Streamflow and SWE.</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthlyfinal, <span class="fu">aes</span>(<span class="at">x =</span> month)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_streamflow), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_swe<span class="sc">*</span><span class="dv">100</span>), <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span>  </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Streamflow (cfs)"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="dv">10</span>, <span class="at">name =</span> <span class="st">"SWE (mm)"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Streamflow and Scaled SWE"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"purple"</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"blue"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'
`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p><strong>Figure 5. Average Monthly Swe and Streamflow Trends by Year for the 10 year study period.</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthlyfinal, <span class="fu">aes</span>(<span class="at">x =</span> month)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_swe<span class="sc">*</span><span class="dv">100</span>), <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span>  </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_streamflow), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Streamflow (cfs)"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="dv">10</span>, <span class="at">name =</span> <span class="st">"SWE (mm)"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly SWE and Streamflow Trends by Year"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'
`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p><strong>Figure 6. Monthly patterns of streamflow in the Cache la Poudre River and SWE at the Joe Wright SNOTEL Station over a 10 year period.</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>monthly_flow <span class="ot">&lt;-</span> swe_disch <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_Q =</span> <span class="fu">mean</span>(Q))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>monthly_disch_tbl <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(monthly_flow) <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>monthly_disch <span class="ot">&lt;-</span> <span class="fu">gg_subseries</span>(monthly_disch_tbl, <span class="at">y =</span> mean_Q) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Streamflow Patterns"</span>, <span class="at">y =</span> <span class="st">"Flow"</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>monthly_swe <span class="ot">&lt;-</span> swe_disch <span class="sc">|&gt;</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_swe =</span> <span class="fu">mean</span>(swe))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>monthly_swe_tbl <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(monthly_swe) <span class="sc">|&gt;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>monthly_swe <span class="ot">&lt;-</span> <span class="fu">gg_subseries</span>(monthly_swe_tbl, <span class="at">y =</span> mean_swe) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly SWE Patterns"</span>, <span class="at">y =</span> <span class="st">"Snow Water Equivalent"</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>monthly_disch <span class="sc">+</span> monthly_swe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p><strong>Figure 7. Results of Linear Regression</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>swe_disch <span class="ot">&lt;-</span> swe_disch <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">log_Q =</span> <span class="fu">log1p</span>(Q))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_Q <span class="sc">~</span> swe, <span class="at">data =</span> swe_disch)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_Q ~ swe, data = swe_disch)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.4056 -0.6343  0.2720  1.6738  4.7426 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.459642   0.052943  84.235  &lt; 2e-16 ***
swe         -0.022536   0.004574  -4.927 8.71e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.414 on 3909 degrees of freedom
Multiple R-squared:  0.006171,  Adjusted R-squared:  0.005917 
F-statistic: 24.27 on 1 and 3909 DF,  p-value: 8.713e-07</code></pre>
</div>
</div></div>
<p><strong>Figure 8. Pre and Post Wildfire t-test</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>swe_disch<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(swe_disch<span class="sc">$</span>date)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>pre_fire_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-07-01"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>pre_fire_end <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-07-30"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>post_fire_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-01"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>post_fire_end <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2021-07-30"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>pre_fire_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(swe_disch, date <span class="sc">&gt;=</span> pre_fire_start <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> pre_fire_end)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>post_fire_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(swe_disch, date <span class="sc">&gt;=</span> post_fire_start <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> post_fire_end)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>t_test_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(pre_fire_data<span class="sc">$</span>Q, post_fire_data<span class="sc">$</span>Q)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_test_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  pre_fire_data$Q and post_fire_data$Q
t = -2.1925, df = 55.64, p-value = 0.03255
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -215.426536   -9.699901
sample estimates:
mean of x mean of y 
 353.3333  465.8966 </code></pre>
</div>
</div></div>
<p><strong>Figure 9. Cross Correlation</strong></p>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>swe <span class="ot">&lt;-</span> swe_disch<span class="sc">$</span>swe</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>discharge <span class="ot">&lt;-</span> swe_disch<span class="sc">$</span>Q</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>swe <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(swe)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>discharge <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(discharge)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>ccf_result <span class="ot">&lt;-</span> <span class="fu">ccf</span>(swe, discharge, <span class="at">lag.max =</span> <span class="dv">50</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">"Cross-Correlation between SWE and Discharge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>Streamflow patterns based on snow water equivalent provide information valuable for water management, flood prediction, and drought conditions. The drops in SWE and streamflow in 2012 may be explained by decreased precipitation levels. Low seasonal precipitation periods like this may lead to increased drought as they occur more frequently. It is important to understand snowpack and snow water equivalent because they are indicators of how much water will enter the river in the following months, and when this water enters the streamflow. This relationship between swe and discharge is directly related, enabling swe to be a predictor of streamflow <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. When creating models for water supply predictions, years where drought occurred may bring errors while training the models to predict streamflow <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. Fluctuations in precipitation are becoming an increasingly apparent problem, especially in snow-reliant watersheds.</p>
<p>When there are higher levels of snow water equivalent, there is more opportunity for melting and increased discharge when temperature fluctuations occur. Drought has caused evident declines in snowpack and subsequently, streamflow <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. In turn, there has been increased variability in snowpack and streamflow interannually, creating difficulties predicting water supply <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. Drought years are hard to predict because historical snowpack and streamflow data do not consistently reflect these changes in climate <span class="citation" data-cites="modi2022">(<a href="#ref-modi2022" role="doc-biblioref">Modi et al., 2022</a>)</span>. Seasonal changes in snow precipitation can show patterns, however differences in year to year patterns are harder to understand given the level of fluctuation in the data (Figure 1). Understanding the lag patterns between snow water equivalent and stream discharge are also integral to predicting the timing of flooding, in conjunction with weather patterns and predictions of increased rainfall. This can allow communities to prepare for less-than ideal conditions and mitigate damage and loss.</p>
<p>Two major floods in the Cache la Poudre River were mainly caused by increased rainfall events following severe wildfires. High severity wildfires increase erosion and decrease infiltration rates <span class="citation" data-cites="18049275620241201">(<a href="#ref-18049275620241201" role="doc-biblioref">Triantafillou &amp; Wohl, 2024</a>)</span>. This causes an abnormally high amount of water to enter a river instead of permeating the soil and entering groundwater, which creates high flows and even flooding in some areas. The High Park Fire in 2012 preceded a severe flood in the Cache la Poudre River in 2013. In a similar instance, the Cameron Peak Fire in 2020 contributed to a major flood in the Poudre River in 2021. Given that drought conditions already decrease soil infiltration, the combination of drought conditions and increased wildfires could have detrimental effects on potential flood areas and snow-reliant watersheds. Having the knowledge of SWE and its predictive qualities of streamflow can assist in predicting floods following wildfires, high levels of precipitation during the winter, and increased discharge in the spring. This ability to predict natural events allows time for mitigation and preparation of the community.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-hammond2018" class="csl-entry" role="listitem">
Hammond, J. C., Saavedra, F. A., &amp; Kampf, S. K. (2018). How does snow persistence relate to annual streamflow in mountain watersheds of the western US with wet maritime and dry continental climates? <em>Water Resources Research</em>, <em>54</em>(4), 2605–2623.
</div>
<div id="ref-maity2011" class="csl-entry" role="listitem">
Maity, R., &amp; Kashid, S. (2011). Importance analysis of local and global climate inputs for basin-scale streamflow prediction. <em>Water Resources Research</em>, <em>47</em>(11).
</div>
<div id="ref-modi2022" class="csl-entry" role="listitem">
Modi, P. A., Small, E. E., Kasprzyk, J., &amp; Livneh, B. (2022). Investigating the role of snow water equivalent on streamflow predictability during drought. <em>Journal of Hydrometeorology</em>, <em>23</em>(10), 1607–1625.
</div>
<div id="ref-18049275620241201" class="csl-entry" role="listitem">
Triantafillou, S., &amp; Wohl, E. (2024). Geomorphic characteristics influencing post-fire river response in mountain streams. <em>Geomorphology</em>, <em>466</em>, N.PAG. Retrieved from <a href="https://ezproxy2.library.colostate.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&amp;amp;AuthType=cookie,ip,url,cpid&amp;amp;custid=s4640792&amp;amp;db=aph&amp;amp;AN=180492756&amp;amp;site=ehost-live">https://ezproxy2.library.colostate.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&amp;amp;AuthType=cookie,ip,url,cpid&amp;amp;custid=s4640792&amp;amp;db=aph&amp;amp;AN=180492756&amp;amp;site=ehost-live</a>
</div>
</div>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"selector":".lightbox","openEffect":"zoom","loop":false,"closeEffect":"zoom","descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>